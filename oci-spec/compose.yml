services:
  protogen:
    build:
      # both context and dockerfile path
      # set to the root of the repo
      context: ".."
      dockerfile: "./oci-spec/Dockerfile"
      tags:
        - "localhost:5000/hidohyou:latest"
      args:
        PLATFORM: ${PLATFORM}
        PROTOC_VERSION: ${PROTOC_VERSION}
    ports:
      - "2112:2112"
      - "8080:8080"
    stop_signal: SIGINT
    #working_dir: "/source"
    #volumes:
    #  - "../pb:/source"
    #command: bash -c "
    #    protoc *.proto --proto_path=.
    #     --go_out=. --go_opt=module=github.com/user/echo-contracts/pb
    #     --go-grpc_out=. --go-grpc_opt=module=github.com/user/echo-contracts/pb
    #    "
  grafana:
    image: grafana/grafana:9.3.0
    ports:
      - 3000:3000
    environment:
      - GF_SECURITY_ADMIN_USER=admin
      - GF_SECURITY_ADMIN_PASSWORD=devops123
    volumes:
      - ./grafana/datasources.yaml:/etc/grafana/provisioning/datasources/datasources.yaml
      - grafana:/var/lib/grafana

volumes:
  grafana:



